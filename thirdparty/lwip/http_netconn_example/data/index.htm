<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
"http://www.w3.org/TR/html4/loose.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
	<head>
		<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
		<title>ATMEL SAM web server and DSP demo</title>
		<link rel="stylesheet" type="text/css" media="screen" href="etc/style.css" />
		<script type="text/javascript" src="etc/js/jquery.js"></script>
		<script type="text/javascript" src="etc/js/excan.js"></script>
		<script type="text/javascript" src="etc/js/jqflot.js"></script>
		<script type="text/javascript">
			$(document).ready(function() {
				$.ajax({
					  url: "get_chipinfo",
					  dataType :'json',
					  async: false,
					  cache: false,
					  success: function(data){
					    	$.each(data,function(k,v){
					    		$('#'+k).text(v);
					    	});
   					  }
					});
   				var set_led_status = function(elm,status) {

   					if (status == 1) {
						elm.addClass('led-on').removeClass('led-off').text('ON').append("<span></span>");
   					} else {
   						elm.addClass('led-off').removeClass('led-on').text('OFF').prepend("<span></span>");
	   				}
   				}
   				$("span[id^=led]").click(function(){
   					var elm = $(this);
					if (elm.hasClass('led-off')) {
						var status = 1;
					} else {
						var status = 0;
					}
					set_led_status(elm, status);
					$.ajax({
					  url: "set_led",
					  async: false,
					  cache: false,
					  data:{'n':elm.attr('name'),'set':status},
					  dataType :'json',
					  success: function(){
					  }
					});
   				});
   				var options = {
			        series: { shadowSize: 0 },
			        yaxis:  { min: 0, max: 100 },
			        xaxis:  { min: 0, max: 10000 }
			    };

				var magnitude_data = [];
				var plot_magnitude = $.plot($("#magnitude-plot"), [{label: "Magnitude", data:magnitude_data}], options);
				var reg = new RegExp("[|]+", "g");

			    function updateStatus() {

			$.ajax({
					  url: "status",
					  async: false,
					  cache: false,
					  dataType :'json',
					  success: function(data){

						 $('#lwip_mem_heap').width(350*(parseInt(data['lwip_m_heap'])/parseInt(data['lwip_m_heap_s'])));
						 $('#lwip_mem_heap-value').text(data['lwip_m_heap'])
						 $('#lwip_mem_heap-value_size').text(data['lwip_m_heap_s'])
						 $('#lwip_mem_heap-value_max').text(data['lwip_m_heap_m'])

						 $('#lwip_pbuf_pool').width(350*(parseInt(data['lwip_pp'])/parseInt(data['lwip_pp_s'])));
						 $('#lwip_pbuf_pool-value').text(data['lwip_pp'])
						 $('#lwip_pbuf_pool-value_size').text(data['lwip_pp_s'])
						 $('#lwip_pbuf_pool-value_max').text(data['lwip_pp_m'])

						 $('#lwip_pbuf_ref').width(350*(parseInt(data['lwip_pr'])/parseInt(data['lwip_pr_s'])));
						 $('#lwip_pbuf_ref-value').text(data['lwip_pr'])
						 $('#lwip_pbuf_ref-value_size').text(data['lwip_pr_s'])
						 $('#lwip_pbuf_ref-value_max').text(data['lwip_pr_m'])

						 $('#lwip_tcp_pcb').width(350*(parseInt(data['lwip_tcp_pcb'])/parseInt(data['lwip_tcp_pcb_s'])));
						 $('#lwip_tcp_pcb-value').text(data['lwip_tcp_pcb'])
						 $('#lwip_tcp_pcb-value_size').text(data['lwip_tcp_pcb_s'])
						 $('#lwip_tcp_pcb-value_max').text(data['lwip_tcp_pcb_m'])

						 $('#lwip_tcp_seg').width(350*(parseInt(data['lwip_tcp_seg'])/parseInt(data['lwip_tcp_seg_s'])));
						 $('#lwip_tcp_seg-value').text(data['lwip_tcp_seg'])
						 $('#lwip_tcp_seg-value_size').text(data['lwip_tcp_seg_s'])
						 $('#lwip_tcp_seg-value_max').text(data['lwip_tcp_seg_m'])


						 $('#uptime').text(data['up_time'] +' sec');
						 $('#local_ip').text(data['local_ip']);
						 $('#last_connected_ip').text(data['last_connected_ip']);
						 $('#tot_req').text(data['tot_req']);

						 $.each(data['leds'], function (key,v) {
							set_led_status($('#led-' + key), v);
							});

						 magnitude_data.length = 0;
						 var tab = data['mag'].split(reg);
						 for (var i = 0; i < tab.length; i++)
							 magnitude_data.push([i*100,tab[i]]);
						 plot_magnitude.setData([{label: "Magnitude", data:magnitude_data}]);
						 plot_magnitude.setupGrid();
						 plot_magnitude.draw();
						 setTimeout(updateStatus, 500);
					  }
					});
			    }
			   updateStatus();
			});

		</script>
	</head>
	<body>

		<div id="wrapper">
			<div id="conteiner">
				<div id="header">
					<img src="etc/img/atmel.png" alt="ATMEL Logo" />
					<div>
						<h1>LwIP HTTP netconn example</h1><br>
						<h3>System and network monitor</h3>
					</div>
				</div>
				<div class="content">
					<b>Hardware Info:</b><br>
					<b>CPU Core: </b><span id="core_name">--</span><br>
					<b>Chip name: </b><span id="arch_name">--</span><br>
					<b>SRAM size: </b><span id="sram_size">--</span><br>
					<b>Flash size: </b><span id="flash_size">--</span><br><br>

					<b>Connections Info:</b><br>
					<b>Board IP: </b><span id="local_ip">--</span><br>
					<b>Your IP: </b><span id="last_connected_ip">--</span><br>
					<b>Total status requests: </b><span id="tot_req">--</span><br><br>
					Press button "BP3" to switch between wave file loopback and generated sinus mode.<br>
					Potentiometer can be used to change sinus frequency in sinus mode.<br>
					Use QTouch slider to change audio out pitch.<br><br>
					<div class="control">
						<b class="label">LwIP memory heap:</b>
						<span class="trigger"><span id="lwip_mem_heap">&nbsp;</span></span>&nbsp;<div class="label2">Cur:<span id="lwip_mem_heap-value">0</span></div>&nbsp;<div class="label2">Size:<span id="lwip_mem_heap-value_size">0</span></div>&nbsp;<div class="label2">Max:<span id="lwip_mem_heap-value_max">0</span></div><br>
					</div>
					<div class="control">
						<b class="label">LwIP PBUF pool:</b>
						<span class="trigger"><span id="lwip_pbuf_pool">&nbsp;</span></span>&nbsp;<div class="label2">Cur:<span id="lwip_pbuf_pool-value">0</span></div>&nbsp;<div class="label2">Size:<span id="lwip_pbuf_pool-value_size">0</span></div>&nbsp;<div class="label2">Max:<span id="lwip_pbuf_pool-value_max">0</span></div><br>
					</div>
					<div class="control">
						<b class="label">LwIP PBUF ref:</b>
						<span class="trigger"><span id="lwip_pbuf_ref">&nbsp;</span></span>&nbsp;<div class="label2">Cur:<span id="lwip_pbuf_ref-value">0</span></div>&nbsp;<div class="label2">Size:<span id="lwip_pbuf_ref-value_size">0</span></div>&nbsp;<div class="label2">Max:<span id="lwip_pbuf_ref-value_max">0</span></div><br>
					</div>
					<div class="control">
						<b class="label">LwIP TCP PCB:</b>
						<span class="trigger"><span id="lwip_tcp_pcb">&nbsp;</span></span>&nbsp;<div class="label2">Cur:<span id="lwip_tcp_pcb-value">0</span></div>&nbsp;<div class="label2">Size:<span id="lwip_tcp_pcb-value_size">0</span></div>&nbsp;<div class="label2">Max:<span id="lwip_tcp_pcb-value_max">0</span></div><br>
					</div>
					<div class="control">
						<b class="label">LwIP queued TCP seg:</b>
						<span class="trigger"><span id="lwip_tcp_seg">&nbsp;</span></span>&nbsp;<div class="label2">Cur:<span id="lwip_tcp_seg-value">0</span></div>&nbsp;<div class="label2">Size:<span id="lwip_tcp_seg-value_size">0</span></div>&nbsp;<div class="label2">Max:<span id="lwip_tcp_seg-value_max">0</span></div><br>
					</div>
				</div>
				<div class="content">
					<div class="control">
						<b class="label">FreeRTOS uptime:</b><span id="uptime" class="box">--</span><br>
						<b class="label">Temperature sensor:</b><span id="temperature" class="box">--</span><br/>
					</div>
					<div class="control">
						<b>Led status:</b><br/>
						<span id="led-0" name="0" class="led led-off">--</span><span id="led-1" name="1" class="led led-off">--</span><span id="led-2" name="2" class="led led-off">--</span>
					</div>
					<div class="control">
						<b>Potentiometer value:</b><br/>
						<span class="trigger"><span id="potentiometer">&nbsp;</span></span>&nbsp;<span id="potentiometer-value">--</span>
					</div>
				</div>
				<div class="content">
						<b>FFT input signal magnitude:</b><br/>
						<div id="magnitude-plot" class="magnitude-plot"></div>
				</div>
				<div  class="content footer">
						Please visit <a href="http://www.atmel.com">www.atmel.com</a> for more info
				</div>
			</div>
		</div>

	</body>
</html>
